name: Trigger NGINX Build

on:
  release:
    types: [published]

  workflow_dispatch:
    inputs:
      nginx_version:
        description: "Optional: Specify NGINX version to build (leave blank for latest)"
        required: false
        default: ""

jobs:
  trigger-build:
    name: Trigger NGINX Build in ci-bot
    runs-on: ubuntu-latest

    steps:
      - name: Debug Print - Input Version
        run: |
          echo "ðŸ“¥ Provided version: '${{ github.event.inputs.nginx_version }}'"

      - name: Determine NGINX Version to Build
        id: version
        run: |
          set -e 
          VERSION_INPUT="${{ github.event.inputs.nginx_version }}"
          if [ -z "$VERSION_INPUT" ]; then
            echo "ðŸ“¡ No version specified. Fetching latest NGINX release from GitHub..."
            latest=$(curl -s https://api.github.com/repos/nginx/nginx/releases/latest | jq -r '.tag_name')
            echo "âœ… Using latest version: $latest"
            echo "nginx_version=$latest" >> "$GITHUB_OUTPUT"
          else
            echo "âœ… Using provided version: $VERSION_INPUT"
            echo "nginx_version=$VERSION_INPUT" >> "$GITHUB_OUTPUT"
